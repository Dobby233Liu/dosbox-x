on: [push, pull_request] # TODO: release [released, prereleased]

jobs:
  vsbuild:
    name: Build for VS
    runs-on: windows-latest # this image currently has VS2019, but may change in any time

    matrix:
      strategy:
        arch: [Win32, x64, ARM32, ARM64]
        type: [Release, "Release SDL2"]
      # TODO: use python powershell or perl to convert to zip name later???

    steps:
      - uses: actions/checkout@v2
        name: Checkout repo
      - uses: microsoft/setup-msbuild@master # master because template
      - name: Build
        working-directory: vs2015
        env:
          GH_BUILD_TYPE: ${{ matrix.type }}
          GH_BUILD_ARCH: ${{ matrix.arch }}
        run: |
          msbuild dosbox-x.sln /p:Configuration=$env:GH_BUILD_TYPE /p:Platform=$env:GH_BUILD_ARCH
      - name: Push into artifacts
        uses: actions/upload-artifact@v2
        with:
          name: ${{ matrix.type }} ${{ matrix.arch }} # TODO: use generated zipname
          path:
            bin/${{ matrix.arch }}/${{ matrix.type }}
